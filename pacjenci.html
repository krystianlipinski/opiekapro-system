<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista Pacjentów - OpiekaPRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 2rem auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-content { transition: transform 0.3s ease-out, opacity 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">
    <!-- Twój cały HTML (sidebar + header + main) zostaje dokładnie taki sam – kopiuj z Twojego pliku, ja wklejam tylko zmienioną część JS na dole -->

    <!-- ... wklej tutaj cały swój HTML od <div class="flex h-screen... do końca </div> przed <script> – identycznie jak miałeś ... -->

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2'

        const supabaseUrl = 'https://uxbiizkucgcwzqqgjlhu.supabase.co'
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4Ymlpemt1Y2djd3pxcWdqbGh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NTM3MzUsImV4cCI6MjA3OTMyOTczNX0.MMfsEO2ePERP0OtfuotxyHdUfHuKV3OV0uAoTTLfnZY'

        const supabase = createClient(supabaseUrl, supabaseAnonKey)

        let patients = [];

        // Ładowanie pacjentów z bazy
        async function loadPatients() {
            // Pokaz loader
            tableBody.innerHTML = '<tr><td colspan="5"><div class="loader"></div></td></tr>';

            const { data, error } = await supabase
                .from('patients')
                .select('*')
                .order('last_name', { ascending: true });

            if (error) {
                console.error('Błąd:', error);
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center p-6 text-red-600">Błąd połączenia z bazą danych</td></tr>';
                return;
            }

            patients = data.map(p => ({
                id: p.id,
                name: `${p.first_name || ''} ${p.last_name || ''}`.trim() || 'Brak nazwisko',
                room: p.room || 'Brak',
                priority: p.priority || 'Niski',
                tasks: 0 // na razie 0 – później policzymy zadania
            }));

            renderTable(); // Twoja funkcja renderTable z kodu
        }

        // Reszta Twojego kodu JS (filtr, paginacja, modale) zostaje bez zmian
        // Tylko dodaj na końcu:

        document.addEventListener('DOMContentLoaded', () => {
            loadPatients(); // ładujemy z bazy przy starcie

            // Tu wklej cały swój stary kod z event listenerami (search, filter, pagination itd.) – identycznie jak miałeś
        });
    </script>
</body>
</html>
