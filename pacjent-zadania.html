<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zadania Pacjenta - OpiekaPRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .modal-content {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">
    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar -->
        <aside class="w-64 flex-shrink-0 bg-slate-900 text-white flex flex-col">
            <div class="h-16 flex items-center justify-center text-2xl font-bold border-b border-slate-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-400 mr-2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                <span>OpiekaPRO</span>
            </div>
            <nav id="sidebarNav" class="flex-1 px-4 py-6 space-y-2">
                <a href="pacjenci.html" class="nav-link flex items-center px-4 py-2.5 bg-blue-600 text-white rounded-lg font-semibold shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Pacjenci
                </a>
                <a href="zadania.html" class="nav-link flex items-center px-4 py-2.5 text-slate-300 hover:bg-slate-700 hover:text-white rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M21.2 15c.7-1.2 1-2.5.7-3.9-.6-2.4-3.4-4-6.2-3.3-1.3.3-2.4 1-3.2 2.1-.8-1.1-1.9-1.8-3.2-2.1-2.8-.7-5.6.9-6.2 3.3-.3 1.4 0 2.7.7 3.9l10 10Z"/></svg>
                    Zadania
                </a>
                <a href="uprawnienia.html" class="nav-link flex items-center px-4 py-2.5 text-slate-300 hover:bg-slate-700 hover:text-white rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                    Uprawnienia
                </a>
                <a href="magazyn.html" class="nav-link flex items-center px-4 py-2.5 text-slate-300 hover:bg-slate-700 hover:text-white rounded-lg transition-colors">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>
                    Magazyn
                </a>
				<a href="raporty.html" class="nav-link flex items-center px-4 py-2.5 text-slate-300 hover:bg-slate-700 hover:text-white rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>
                    Raporty
                </a>
                <a href="uzytkownicy.html" class="nav-link flex items-center px-4 py-2.5 text-slate-300 hover:bg-slate-700 hover:text-white rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M18 9a4 4 0 0 0-7.44 2.13"/><path d="M18 9a4 4 0 0 0-7.44 2.13"/><path d="M14 12a4 4 0 1 0-8 0c0 1.4.67 2.67 1.68 3.51L10 17.5V22h4v-4.5l2.32-1.99A3.95 3.95 0 0 0 14 12Z"/><path d="M6 9a4 4 0 0 1 7.4-2.32"/><path d="M6 9a4 4 0 0 1 7.4-2.32"/></svg>
                    Użytkownicy
                </a>
            </nav>
        </aside>

        <!-- Main content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white shadow-sm h-16 flex items-center justify-between px-6">
                <div>
                    <h1 class="text-lg font-semibold text-slate-600">Dom Opieki "Słoneczna Przystań"</h1>
                </div>
                <div class="flex items-center">
                    <span class="mr-4 text-slate-700">Witaj, <span class="font-bold">Piotr Ćwikliński</span></span>
                    <a href="login.html" class="nav-link flex items-center text-red-500 hover:text-red-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                        Wyloguj się
                    </a>
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-slate-100 p-6">
                <div class="container mx-auto">
                    <div class="mb-6 text-sm text-slate-500">
                        <a href="pacjenci.html" class="nav-link hover:underline">Pacjenci</a> / <a href="index.html" class="nav-link hover:underline">Jan Kowalski</a> / <span class="font-semibold text-slate-700">Zadania</span>
                    </div>

                    <div class="flex items-center gap-4 mb-4">
                        <h2 class="text-3xl font-bold text-slate-800">Pacjent: Jan Kowalski</h2>
                        <a href="index.html" class="nav-link text-sm text-blue-600 hover:underline flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="m15 18-6-6 6-6"/></svg>
                            Powrót do szczegółów
                        </a>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <a href="pacjent-zadania.html" class="flex items-center justify-center p-4 bg-blue-500 text-white rounded-xl shadow-lg hover:bg-blue-600 transition-transform transform hover:-translate-y-1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3"><path d="M21.2 15c.7-1.2 1-2.5.7-3.9-.6-2.4-3.4-4-6.2-3.3-1.3.3-2.4 1-3.2 2.1-.8-1.1-1.9-1.8-3.2-2.1-2.8-.7-5.6.9-6.2 3.3-.3 1.4 0 2.7.7 3.9l10 10Z"></path></svg>
                            <span class="font-semibold text-lg">Zadania</span>
                            <span class="ml-2 bg-white text-blue-600 text-sm font-bold px-2.5 py-0.5 rounded-full">12</span>
                        </a>
                        <a href="pacjent-magazyn.html" class="nav-link flex items-center justify-center p-4 bg-white text-slate-700 rounded-xl shadow-lg hover:bg-slate-50 transition-transform transform hover:-translate-y-1 border border-slate-200">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3 text-slate-500"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>
                            <span class="font-semibold text-lg">Magazyn</span>
                        </a>
                        <a href="pacjent-notatki.html" class="nav-link flex items-center justify-center p-4 bg-white text-slate-700 rounded-xl shadow-lg hover:bg-slate-50 transition-transform transform hover:-translate-y-1 border border-slate-200">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3 text-slate-500"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                            <span class="font-semibold text-lg">Notatki</span>
                        </a>
                         <a href="pacjent-choroby.html" class="nav-link flex items-center justify-center p-4 bg-white text-slate-700 rounded-xl shadow-lg hover:bg-slate-50 transition-transform transform hover:-translate-y-1 border border-slate-200">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3 text-slate-500"><path d="M12 2a4.5 4.5 0 0 0-4.5 4.5v9a4.5 4.5 0 0 0 4.5 4.5 4.5 4.5 0 0 0 4.5-4.5v-9A4.5 4.5 0 0 0 12 2Z"/><path d="M10.5 6.5a1.5 1.5 0 0 1 3 0"/><path d="M10.5 10.5a1.5 1.5 0 0 1 3 0"/><path d="m7.5 14.5 4.5-4.5 4.5 4.5"/></svg>
                            <span class="font-semibold text-lg">Choroby</span>
                        </a>
                    </div>
                    
                    <!-- Tasks Section -->
                    <div>
                        <div class="mb-4">
                            <div class="border-b border-slate-200">
                                <nav class="-mb-px flex gap-6" aria-label="Tabs">
                                    <button data-tab="todo" class="tab-btn shrink-0 border-b-2 border-blue-500 px-1 pb-4 text-sm font-medium text-blue-600">
                                        Do zrobienia
                                    </button>
                                    <button data-tab="postponed" class="tab-btn shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-slate-500 hover:border-slate-300 hover:text-slate-700">
                                        Odłożone
                                    </button>
                                    <button data-tab="done" class="tab-btn shrink-0 border-b-2 border-transparent px-1 pb-4 text-sm font-medium text-slate-500 hover:border-slate-300 hover:text-slate-700">
                                        Wykonane
                                    </button>
                                </nav>
                            </div>
                        </div>

                        <div id="tasks-container" class="space-y-4">
                            <div id="todo-tab" class="space-y-4 tab-content">
                                <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4 bg-white rounded-xl shadow-lg p-4 border border-slate-200">
                                     <div><h3 class="text-xl font-bold text-slate-800">Zadania dla pacjenta</h3></div>
                                    <div class="flex gap-2 w-full sm:w-auto">
                                        <button id="addTaskBtn" class="flex items-center bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors shadow-sm w-full sm:w-auto justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                            Dodaj zadanie
                                        </button>
                                    </div>
                                </div>
                                <!-- Zadania będą renderowane przez JS -->
                            </div>

                            <div id="postponed-tab" class="hidden space-y-4 tab-content">
                                <!-- Zadania będą renderowane przez JS -->
                            </div>
                            
                            <div id="done-tab" class="hidden space-y-4 tab-content">
                                <!-- Zadania będą renderowane przez JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Add Task Modal -->
    <div id="addTaskModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-lg transform transition-all opacity-0 scale-95">
             <form id="addTaskForm" class="p-6 space-y-4">
                 <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-slate-800">Dodaj nowe zadanie</h3>
                    <button type="button" id="closeAddTaskModal" class="text-slate-400 hover:text-slate-800 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700">Pacjent</label>
                    <input type="text" value="Jan Kowalski" readonly class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm bg-slate-100 text-slate-500 cursor-not-allowed">
                </div>
                <div>
                    <label for="taskDescription" class="block text-sm font-medium text-slate-700">Opis zadania</label>
                    <textarea id="taskDescription" rows="3" class="form-input mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="np. Podanie leku, zmiana opatrunku..."></textarea>
                </div>
                <div>
                    <label for="warehouseItem" class="block text-sm font-medium text-slate-700">Przedmiot z magazynu (opcjonalnie)</label>
                    <div class="relative">
                        <input type="text" id="warehouseItem" autocomplete="off" class="form-input mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Wpisz min. 3 litery nazwy...">
                        <div id="warehouseSuggestions" class="absolute z-10 w-full bg-white border border-slate-300 rounded-md mt-1 shadow-lg hidden max-h-40 overflow-y-auto">
                            <!-- Warehouse suggestions will be populated here -->
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="taskDate" class="block text-sm font-medium text-slate-700">Data wykonania</label>
                        <input type="date" id="taskDate" class="form-input mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="taskTime" class="block text-sm font-medium text-slate-700">Godzina wykonania</label>
                        <input type="time" id="taskTime" class="form-input mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <div>
                    <label for="taskPriority" class="block text-sm font-medium text-slate-700">Priorytet</label>
                    <select id="taskPriority" class="form-input mt-1 block w-full px-3 py-2 border border-slate-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option>Niski</option>
                        <option selected>Średni</option>
                        <option>Wysoki</option>
                    </select>
                </div>
                 <div class="pt-4 flex justify-end gap-3">
                    <button type="button" id="cancelAddTaskModal" class="nav-link bg-white py-2 px-4 border border-slate-300 rounded-md shadow-sm text-sm font-medium text-slate-700 hover:bg-slate-50">Anuluj</button>
                    <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">Zapisz zadanie</button>
                </div>
             </form>
        </div>
    </div>
    
    <!-- Delete Task Confirmation Modal -->
    <div id="deleteConfirmationModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all opacity-0 scale-95">
             <div class="p-6 text-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-16 h-16 text-red-500 mx-auto mb-4"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                <h3 class="text-xl font-bold text-slate-800">Potwierdź usunięcie</h3>
                <p class="text-slate-500 mt-2">Czy na pewno chcesz usunąć zadanie: <strong id="taskNameToDelete" class="font-medium"></strong>?</p>
            </div>
            <div class="bg-slate-50 px-6 py-4 flex justify-end gap-3 rounded-b-xl">
                <button type="button" id="cancelDeleteBtn" class="bg-white py-2 px-4 border border-slate-300 rounded-md shadow-sm text-sm font-medium text-slate-700 hover:bg-slate-50">Anuluj</button>
                <button type="button" id="confirmDeleteBtn" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">Usuń</button>
            </div>
        </div>
    </div>

    <!-- Unsaved Changes Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all opacity-0 scale-95">
             <div class="p-6 text-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-16 h-16 text-yellow-500 mx-auto mb-4"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                <h3 class="text-xl font-bold text-slate-800">Niezapisane zmiany</h3>
                <p class="text-slate-500 mt-2">Masz niezapisane zmiany. Czy na pewno chcesz opuścić tę stronę? Zadanie nie zostanie dodane.</p>
            </div>
            <div class="bg-slate-50 px-6 py-4 flex justify-end gap-3 rounded-b-xl">
                <button type="button" id="stayBtn" class="bg-white py-2 px-4 border border-slate-300 rounded-md shadow-sm text-sm font-medium text-slate-700 hover:bg-slate-50">Zostań</button>
                <button type="button" id="leaveBtn" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">Opuść</button>
            </div>
        </div>
    </div>
    
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Mock Data ---
        let tasks = [
            { id: 1, description: 'Podanie leku: Polocard', priority: 'Wysoki', due: '2025-10-21, 09:00', status: 'todo' },
            { id: 2, description: 'Podanie leku: Metformax', priority: 'Wysoki', due: '2025-10-21, 09:00', status: 'todo' },
            { id: 3, description: 'Zmiana opatrunku na prawej nodze', priority: 'Średni', due: '2025-10-21, 11:30', status: 'todo' },
            { id: 4, description: 'Pomiar ciśnienia', priority: 'Niski', due: '2025-10-20, 15:05', status: 'done', completedAt: '2025-10-20, 15:05', completedBy: 'Alicja Nowicka' },
            { id: 5, description: 'Spacer po ogrodzie', priority: 'Niski', due: '2025-10-20, 14:00', status: 'postponed' },
             // Dodatkowe zadania dla Jana Kowalskiego do licznika 12
            { id: 6, description: 'Toaleta poranna', priority: 'Średni', due: '2025-10-21, 08:00', status: 'todo' },
            { id: 7, description: 'Asysta przy śniadaniu', priority: 'Niski', due: '2025-10-21, 08:30', status: 'todo' },
            { id: 8, description: 'Kontrola poziomu cukru', priority: 'Wysoki', due: '2025-10-21, 11:00', status: 'todo' },
            { id: 9, description: 'Rehabilitacja oddechowa', priority: 'Średni', due: '2025-10-21, 12:00', status: 'todo' },
            { id: 10, description: 'Asysta przy obiedzie', priority: 'Niski', due: '2025-10-21, 13:00', status: 'todo' },
            { id: 11, description: 'Podanie leku X', priority: 'Wysoki', due: '2025-10-21, 14:00', status: 'todo' },
            { id: 12, description: 'Wieczorna toaleta', priority: 'Średni', due: '2025-10-21, 19:00', status: 'todo' },
        ];

        const warehouseItems = [
            { name: 'Polocard 75mg', owner: 'Dom Opieki' }, { name: 'Pieluchomajtki Seni L', owner: 'Dom Opieki' },
            { name: 'Gaza jałowa 1m x 1m', owner: 'Dom Opieki' }, { name: 'Plaster z opatrunkiem', owner: 'Dom Opieki' },
            { name: 'Paracetamol 500mg', owner: 'Dom Opieki' }, { name: 'Polocard 50mg', owner: 'Jan Kowalski' },
            { name: 'Pieluchy L', owner: 'Jan Kowalski' }, { name: 'Okulary do czytania', owner: 'Jan Kowalski' },
            { name: 'Laska ortopedyczna', owner: 'Jan Kowalski' }, { name: 'Insulina', owner: 'Anna Nowak' }
        ];
        const currentPatientName = "Jan Kowalski";

        // --- Elements ---
        const taskTabs = {
            todo: document.getElementById('todo-tab'),
            postponed: document.getElementById('postponed-tab'),
            done: document.getElementById('done-tab')
        };
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tasksContainer = document.getElementById('tasks-container');

        // Add Task Modal
        const addTaskModal = document.getElementById('addTaskModal');
        const addTaskModalContent = addTaskModal.querySelector('.modal-content');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const closeAddTaskModalBtn = document.getElementById('closeAddTaskModal');
        const cancelAddTaskModalBtn = document.getElementById('cancelAddTaskModal');
        const addTaskForm = document.getElementById('addTaskForm');
        const warehouseItemInput = document.getElementById('warehouseItem');
        const warehouseSuggestions = document.getElementById('warehouseSuggestions');
        
        // Delete Task Modal
        const deleteModal = document.getElementById('deleteConfirmationModal');
        const deleteModalContent = deleteModal.querySelector('.modal-content');
        const taskNameToDeleteSpan = document.getElementById('taskNameToDelete');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        let taskToDeleteId = null;

        // Unsaved Changes Modal
        const confirmationModal = document.getElementById('confirmationModal');
        const confirmationModalContent = confirmationModal.querySelector('.modal-content');
        const stayBtn = document.getElementById('stayBtn');
        const leaveBtn = document.getElementById('leaveBtn');
        const navLinks = document.querySelectorAll('.nav-link');
        let isFormDirty = false;
        let targetUrl = null;

        let activeTab = 'todo';

        const priorityClasses = {
            'Wysoki': { border: 'border-red-500', bg: 'bg-red-100', text: 'text-red-800' },
            'Średni': { border: 'border-yellow-500', bg: 'bg-yellow-100', text: 'text-yellow-800' },
            'Niski': { border: 'border-green-500', bg: 'bg-green-100', text: 'text-green-800' }
        };

        // --- Functions ---
        function openModal(modal, content) {
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            setTimeout(() => { if (content) { content.classList.add('scale-100', 'opacity-100'); content.classList.remove('scale-95', 'opacity-0');} }, 10);
        }
        function closeModal(modal, content) {
             if (content) { content.classList.add('scale-95', 'opacity-0'); content.classList.remove('scale-100', 'opacity-100');}
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }, 200);
        }
        
        function renderTasks() {
            // Clear all tabs
            Object.values(taskTabs).forEach(tab => {
                // Preserve the first child (the "Dodaj zadanie" button container) in todo-tab
                if (tab.id === 'todo-tab') {
                    while (tab.children.length > 1) tab.removeChild(tab.lastChild);
                } else {
                    tab.innerHTML = ''; // Clear other tabs completely
                }
            });

            const tasksForTab = tasks.filter(t => t.status === activeTab);
            const targetContainer = taskTabs[activeTab];

            if (tasksForTab.length === 0 && activeTab !== 'todo') { // Keep 'Dodaj' button visible in 'todo'
                targetContainer.innerHTML = `<p class="text-slate-500 text-center py-8">Brak zadań w tej kategorii.</p>`;
            }

            tasksForTab.forEach(task => {
                const card = document.createElement('div');
                card.className = `task-card bg-white rounded-xl shadow-lg p-4 border-l-4 ${priorityClasses[task.priority].border}`;
                card.dataset.id = task.id;
                card.dataset.taskName = task.description; // For delete modal

                let buttonsHtml = '';
                let dateHtml = `<p class="text-sm text-slate-500">Do wykonania: <span class="font-semibold text-slate-700">${task.due}</span></p>`;

                if (task.status === 'todo') {
                    buttonsHtml = `
                        <button class="complete-btn w-full sm:w-auto flex-1 text-sm bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">Wykonaj</button>
                        <button class="postpone-btn w-full sm:w-auto flex-1 text-sm bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-colors">Odłóż</button>
                    `;
                } else if (task.status === 'postponed') {
                    buttonsHtml = `<button class="restore-btn w-full sm:w-auto flex-1 text-sm bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">Przywróć</button>`;
                } else if (task.status === 'done') {
                    dateHtml = `<p class="text-sm text-slate-500">Wykonano: <span class="font-semibold text-slate-700">${task.completedAt}</span> przez <span class="font-semibold text-slate-700">${task.completedBy}</span></p>`;
                    // No action buttons for 'done' tasks except delete
                }

                card.innerHTML = `
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                        <div class="flex-1 mb-4 sm:mb-0">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-lg text-slate-800 ${task.status === 'done' ? 'line-through' : ''}">${task.description}</span>
                                <span class="ml-3 ${priorityClasses[task.priority].bg} ${priorityClasses[task.priority].text} text-xs font-medium px-2.5 py-0.5 rounded-full">${task.priority} priorytet</span>
                            </div>
                            ${dateHtml}
                        </div>
                        <div class="flex gap-2 w-full sm:w-auto">
                            ${buttonsHtml}
                            <button class="delete-btn p-2 text-slate-500 hover:text-red-600 hover:bg-slate-100 rounded-full transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 pointer-events-none"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </div>
                    </div>
                `;
                targetContainer.appendChild(card);
            });
        }

        // --- Event Listeners ---

        // Tab switching
        tabButtons.forEach(tab => {
            tab.addEventListener('click', () => {
                activeTab = tab.dataset.tab;
                // Style tabs
                tabButtons.forEach(item => {
                    item.classList.remove('border-blue-500', 'text-blue-600');
                    item.classList.add('border-transparent', 'text-slate-500', 'hover:border-slate-300', 'hover:text-slate-700');
                });
                tab.classList.add('border-blue-500', 'text-blue-600');
                tab.classList.remove('border-transparent', 'text-slate-500');
                // Show/Hide content
                Object.values(taskTabs).forEach(content => content.classList.add('hidden'));
                taskTabs[activeTab].classList.remove('hidden');
                
                renderTasks(); // Re-render tasks for the new active tab
            });
        });

        // Task actions (Complete, Postpone, Restore, Delete)
        tasksContainer.addEventListener('click', (e) => {
            const taskCard = e.target.closest('.task-card');
            if (!taskCard) return;
            const taskId = parseInt(taskCard.dataset.id);
            const task = tasks.find(t => t.id === taskId);
            
            if (e.target.closest('.delete-btn')) {
                taskToDeleteId = taskId;
                taskNameToDeleteSpan.textContent = taskCard.dataset.taskName;
                openModal(deleteModal, deleteModalContent);
            }
            if (e.target.closest('.complete-btn')) {
                task.status = 'done';
                task.completedAt = new Date().toLocaleString('pl-PL', { dateStyle: 'short', timeStyle: 'short'});
                task.completedBy = 'Piotr Ćwikliński'; // Mock user
                renderTasks();
            }
            if (e.target.closest('.postpone-btn')) {
                task.status = 'postponed';
                renderTasks();
            }
             if (e.target.closest('.restore-btn')) {
                task.status = 'todo';
                renderTasks();
            }
        });

        // Delete Task Modal Logic
        cancelDeleteBtn.addEventListener('click', () => closeModal(deleteModal, deleteModalContent));
        deleteModal.addEventListener('click', e => { if (e.target === deleteModal) closeModal(deleteModal, deleteModalContent); });
        confirmDeleteBtn.addEventListener('click', () => {
            if (taskToDeleteId) {
                tasks = tasks.filter(t => t.id !== taskToDeleteId);
                renderTasks();
            }
            closeModal(deleteModal, deleteModalContent);
            taskToDeleteId = null;
        });

        // Add Task Modal Logic
        addTaskBtn.addEventListener('click', () => {
            addTaskForm.reset();
            isFormDirty = false;
            openModal(addTaskModal, addTaskModalContent);
        });
        closeAddTaskModalBtn.addEventListener('click', () => closeModal(addTaskModal, addTaskModalContent));
        
        // Warehouse Search Logic
        warehouseItemInput.addEventListener('input', () => {
             const query = warehouseItemInput.value.toLowerCase().trim();
             warehouseSuggestions.innerHTML = '';
             if (query.length < 3) { warehouseSuggestions.classList.add('hidden'); return; }

             const patientItems = warehouseItems.filter(item => item.owner === currentPatientName && item.name.toLowerCase().includes(query));
             const careHomeItems = warehouseItems.filter(item => item.owner === 'Dom Opieki' && item.name.toLowerCase().includes(query));
             const combinedResults = [...patientItems, ...careHomeItems.filter(chItem => !patientItems.some(pItem => pItem.name === chItem.name))];

             if (combinedResults.length > 0) {
                 const list = document.createElement('ul'); list.className = 'max-h-40 overflow-y-auto';
                 combinedResults.forEach(item => {
                     const li = document.createElement('li');
                     li.className = 'px-4 py-2 hover:bg-slate-100 cursor-pointer';
                     li.innerHTML = `${item.name} <span class="text-xs ${item.owner === currentPatientName ? 'text-green-600 font-semibold' : 'text-slate-500'}">(${item.owner})</span>`;
                     li.addEventListener('click', () => {
                         warehouseItemInput.value = item.name;
                         warehouseSuggestions.classList.add('hidden');
                         isFormDirty = true; // Mark form as dirty
                     });
                     list.appendChild(li);
                 });
                 warehouseSuggestions.appendChild(list);
                 warehouseSuggestions.classList.remove('hidden');
             } else {
                 warehouseSuggestions.innerHTML = '<div class="px-4 py-2 text-slate-500">Brak pasujących przedmiotów.</div>';
                 warehouseSuggestions.classList.remove('hidden');
             }
        });
        document.addEventListener('click', (e) => { if (!warehouseItemInput.contains(e.target) && !warehouseSuggestions.contains(e.target)) { warehouseSuggestions.classList.add('hidden'); } });

        // Add Task Form Submission
        addTaskForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newTask = {
                id: Date.now(),
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                due: `${document.getElementById('taskDate').value}, ${document.getElementById('taskTime').value}`,
                status: 'todo',
                // warehouseItem: document.getElementById('warehouseItem').value // Można dodać
            };
            tasks.unshift(newTask); // Add to the beginning of the list
            renderTasks();
            isFormDirty = false; // Reset dirty flag
            closeModal(addTaskModal, addTaskModalContent);
        });

        // Unsaved Changes Modal Logic
        addTaskForm.querySelectorAll('.form-input').forEach(input => {
            input.addEventListener('input', () => { isFormDirty = true; });
        });
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (isFormDirty) {
                    e.preventDefault();
                    targetUrl = link.href;
                    openModal(confirmationModal, confirmationModalContent);
                }
            });
        });
        cancelAddTaskModalBtn.addEventListener('click', (e) => {
             e.preventDefault();
             if (isFormDirty) {
                 targetUrl = null; // We just want to close the modal
                 openModal(confirmationModal, confirmationModalContent);
             } else {
                 closeModal(addTaskModal, addTaskModalContent);
             }
        });
        stayBtn.addEventListener('click', () => closeModal(confirmationModal, confirmationModalContent));
        leaveBtn.addEventListener('click', () => {
            isFormDirty = false;
            closeModal(confirmationModal, confirmationModalContent);
            if (targetUrl) {
                window.location.href = targetUrl;
            } else {
                 closeModal(addTaskModal, addTaskModalContent); // This was a cancel action
            }
        });

        // Initial Render
        renderTasks();
    });
</script>
</body>
</html>

